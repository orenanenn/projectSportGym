{% extends "base.html" %}
{% block title %}Люди — Спорт & Фітнес{% endblock %}

{% block content %}
<div class="card rounded-3 shadow-sm people-page">
  <div class="card-header bg-white border-bottom">
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
      <ul class="nav nav-pills mb-0">
        <li class="nav-item">
          <a class="nav-link {% if kind == 'clients' %}active{% endif %}"
             href="{% url 'accounts:people' %}?kind=clients{% if q %}&q={{ q|urlencode }}{% endif %}">Клієнти</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if kind == 'trainers' %}active{% endif %}"
             href="{% url 'accounts:people' %}?kind=trainers{% if q %}&q={{ q|urlencode }}{% endif %}">Тренери</a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if kind == 'managers' %}active{% endif %}"
             href="{% url 'accounts:people' %}?kind=managers{% if q %}&q={{ q|urlencode }}{% endif %}">Менеджери</a>
        </li>
      </ul>

      <div class="d-flex flex-wrap align-items-center gap-2">
        <form method="get" class="d-flex gap-2 mb-0">
          <input type="hidden" name="kind" value="{{ kind }}">
          <input type="search" name="q" value="{{ q }}" class="form-control"
                 placeholder="Пошук: ім'я, логін, телефон, email">
          <button class="btn btn-accent">Пошук</button>
        </form>
        {% if can_manage %}
          <a class="btn btn-outline-accent" href="{% url 'accounts:user_create' %}">+ Створити користувача</a>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead class="small text-uppercase" style="background:#F8F8F8; color:#403D3E;">
          <tr>
            <th>#</th>
            <th>
              <a class="text-decoration-none"
                 href="{% url 'accounts:people' %}?kind={{ kind }}{% if q %}&q={{ q|urlencode }}{% endif %}&sort=name&dir={% if sort == 'name' and dir == 'asc' %}desc{% else %}asc{% endif %}">
                ПІБ
                {% if sort == 'name' %}{% if dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
              </a>
            </th>
            <th>Логін</th>
            <th>Email</th>
            <th>Телефон</th>
            <th>Стать</th>
            <th>
              <a class="text-decoration-none"
                 href="{% url 'accounts:people' %}?kind={{ kind }}{% if q %}&q={{ q|urlencode }}{% endif %}&sort=created&dir={% if sort == 'created' and dir == 'asc' %}desc{% else %}asc{% endif %}">
                Створено
                {% if sort == 'created' %}{% if dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
              </a>
            </th>
            {% if kind == 'trainers' %}
              <th>Спеціалізація</th>
              <th>Статус</th>
            {% endif %}
            {% if can_manage %}
              <th class="text-end">Дії</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for p in profiles %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{% firstof p.full_name p.user.get_full_name p.user.username %}</td>
              <td>{{ p.user.username }}</td>
              <td>{{ p.email|default:"—" }}</td>
              <td>{{ p.phone|default:"—" }}</td>
              <td>{{ p.get_gender_display|default:"—" }}</td>
              <td>
                {% if p.created %}{{ p.created|date:"Y-m-d H:i" }}
                {% elif p.created_at %}{{ p.created_at|date:"Y-m-d H:i" }}
                {% elif p.date_created %}{{ p.date_created|date:"Y-m-d H:i" }}
                {% else %}{{ p.user.date_joined|date:"Y-m-d H:i" }}{% endif %}
              </td>

              {% if kind == 'trainers' %}
                <td>{% if p.get_specialization_display %}{{ p.get_specialization_display }}{% else %}{{ p.specialization|default:"—" }}{% endif %}</td>
                <td>{% if p.get_status_display %}{{ p.get_status_display }}{% else %}{{ p.status|default:"—" }}{% endif %}</td>
              {% endif %}

              {% if can_manage %}
                <td class="text-end">
                  <div class="btn-group btn-group-sm">
                    <a class="btn btn-outline-accent" href="{% url 'accounts:user_edit' p.user.id %}">Редагувати</a>
                    <a class="btn btn-outline-warning" href="{% url 'accounts:user_password_reset' p.user.id %}">Пароль</a>
                    <a class="btn btn-outline-danger" href="{% url 'accounts:user_delete' p.user.id %}">Видалити</a>
                  </div>
                </td>
              {% endif %}
            </tr>
          {% empty %}
            <tr>
              <td colspan="99" class="text-center text-muted py-4">Нічого не знайдено.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
